<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>马上豹AI工具中心</title>
    <!-- 引入Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- 引入Font Awesome -->
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    
    <!-- 配置Tailwind自定义颜色和字体 -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#2563eb',
                        secondary: '#eff6ff',
                        neutral: '#f3f4f6',
                        dark: '#1f2937',
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    
    <!-- 自定义工具类 -->
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .nav-active {
                @apply bg-secondary border-l-4 border-primary text-primary font-medium;
            }
            .transition-height {
                transition: max-height 0.3s ease-in-out;
            }
            .shadow-soft {
                box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            }
        }
    </style>
    
    <style>
        /* 基础动画定义 */
        .fade-enter {
            opacity: 0;
        }
        .fade-enter-active {
            opacity: 1;
            transition: opacity 0.3s ease-in-out;
        }
        .fade-exit {
            opacity: 1;
        }
        .fade-exit-active {
            opacity: 0;
            transition: opacity 0.3s ease-in-out;
        }
        
        /* 平滑滚动 */
        html {
            scroll-behavior: smooth;
        }
        
        /* 自定义滚动条 */
        ::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        ::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 3px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #a1a1a1;
        }
        
        /* 导航项动画 */
        .nav-item {
            transition: all 0.2s ease;
        }
    </style>
</head>
<body class="bg-gray-50 h-screen flex overflow-hidden text-gray-800">
    <!-- 左侧导航栏 -->
    <aside id="sidebar" class="w-64 bg-white shadow-soft flex flex-col h-full overflow-hidden border-r border-gray-200">
        <!-- 导航头部 -->
        <div class="p-4 border-b border-gray-200 flex items-center">
            <div class="w-8 h-8 bg-primary rounded-md flex items-center justify-center text-white mr-3">
                <i class="fa fa-rocket"></i>
            </div>
            <h1 class="text-lg font-semibold">马上豹AI中心</h1>
        </div>
        
        <!-- 导航内容区域 -->
        <div class="flex-1 overflow-y-auto">
            <!-- 主导航部分 -->
            <div class="p-2">
                <h2 class="text-xs font-semibold text-gray-500 uppercase tracking-wider px-3 py-2">工具导航</h2>
                
                <!-- 工作台 -->
                <div class="nav-group mb-1">
                    <div class="nav-item flex items-center justify-between px-3 py-2.5 rounded-md cursor-pointer hover:bg-gray-100" data-group="workbench">
                        <span>工作台</span>
                        <button class="add-secondary text-gray-400 hover:text-primary transition-colors" data-parent="workbench">
                            <i class="fa fa-plus-circle"></i>
                        </button>
                    </div>
                    <div class="subnav pl-6 overflow-hidden max-h-0 transition-height" id="workbench">
                        <div class="nav-item flex items-center justify-between px-3 py-2 rounded-md cursor-pointer hover:bg-gray-100" 
                             data-url="work.html" data-name="工作台首页">
                            <span>工作台首页</span>
                            <button class="edit-item text-gray-400 hover:text-primary transition-colors" data-id="workbench-home">
                                <i class="fa fa-pencil"></i>
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- 选品工具 -->
                <div class="nav-group mb-1">
                    <div class="nav-item flex items-center justify-between px-3 py-2.5 rounded-md cursor-pointer hover:bg-gray-100" data-group="product-selection">
                        <span>选品工具</span>
                        <button class="add-secondary text-gray-400 hover:text-primary transition-colors" data-parent="product-selection">
                            <i class="fa fa-plus-circle"></i>
                        </button>
                    </div>
                    <div class="subnav pl-6 overflow-hidden max-h-0 transition-height" id="product-selection">
                        <div class="nav-item flex items-center justify-between px-3 py-2 rounded-md cursor-pointer hover:bg-gray-100" 
                             data-url="https://shop.douyin.com/" data-name="抖音商城">
                            <span>抖音商城</span>
                            <button class="edit-item text-gray-400 hover:text-primary transition-colors" data-id="dy-mall">
                                <i class="fa fa-pencil"></i>
                            </button>
                        </div>
                        <div class="nav-item flex items-center justify-between px-3 py-2 rounded-md cursor-pointer hover:bg-gray-100" 
                             data-url="https://www.sellersprite.com/" data-name="卖家精灵">
                            <span>卖家精灵</span>
                            <button class="edit-item text-gray-400 hover:text-primary transition-colors" data-id="seller-sprite">
                                <i class="fa fa-pencil"></i>
                            </button>
                        </div>
                        <div class="nav-item flex items-center justify-between px-3 py-2 rounded-md cursor-pointer hover:bg-gray-100" 
                             data-url="news.html" data-name="热门资讯">
                            <span>热门资讯</span>
                            <button class="edit-item text-gray-400 hover:text-primary transition-colors" data-id="hot-news">
                                <i class="fa fa-pencil"></i>
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- 找品工具 -->
                <div class="nav-group mb-1">
                    <div class="nav-item flex items-center justify-between px-3 py-2.5 rounded-md cursor-pointer hover:bg-gray-100" data-group="product-finding">
                        <span>找品工具</span>
                        <button class="add-secondary text-gray-400 hover:text-primary transition-colors" data-parent="product-finding">
                            <i class="fa fa-plus-circle"></i>
                        </button>
                    </div>
                    <div class="subnav pl-6 overflow-hidden max-h-0 transition-height" id="product-finding">
                        <div class="nav-item flex items-center justify-between px-3 py-2 rounded-md cursor-pointer hover:bg-gray-100" 
                             data-url="https://www.1688.com/" data-name="1688">
                            <span>1688</span>
                            <button class="edit-item text-gray-400 hover:text-primary transition-colors" data-id="1688">
                                <i class="fa fa-pencil"></i>
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- 测品工具 -->
                <div class="nav-group mb-1">
                    <div class="nav-item flex items-center justify-between px-3 py-2.5 rounded-md cursor-pointer hover:bg-gray-100" data-group="product-testing">
                        <span>测品工具</span>
                        <button class="add-secondary text-gray-400 hover:text-primary transition-colors" data-parent="product-testing">
                            <i class="fa fa-plus-circle"></i>
                        </button>
                    </div>
                    <div class="subnav pl-6 overflow-hidden max-h-0 transition-height" id="product-testing">
                        <div class="nav-item flex items-center justify-between px-3 py-2 rounded-md cursor-pointer hover:bg-gray-100" 
                             data-url="https://ad.kaogujia.com/" data-name="考古加">
                            <span>考古加</span>
                            <button class="edit-item text-gray-400 hover:text-primary transition-colors" data-id="kaogujia">
                                <i class="fa fa-pencil"></i>
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- 素材处理 -->
                <div class="nav-group mb-1">
                    <div class="nav-item flex items-center justify-between px-3 py-2.5 rounded-md cursor-pointer hover:bg-gray-100" data-group="material-processing">
                        <span>素材处理</span>
                        <button class="add-secondary text-gray-400 hover:text-primary transition-colors" data-parent="material-processing">
                            <i class="fa fa-plus-circle"></i>
                        </button>
                    </div>
                    <div class="subnav pl-6 overflow-hidden max-h-0 transition-height" id="material-processing">
                        <div class="nav-item flex items-center justify-between px-3 py-2 rounded-md cursor-pointer hover:bg-gray-100" 
                             data-url="preprocess.html" data-name="预处理下载">
                            <span>预处理下载</span>
                            <button class="edit-item text-gray-400 hover:text-primary transition-colors" data-id="preprocess">
                                <i class="fa fa-pencil"></i>
                            </button>
                        </div>
                        <div class="nav-item flex items-center justify-between px-3 py-2 rounded-md cursor-pointer hover:bg-gray-100" 
                             data-url="video-analysis.html" data-name="AI分镜解析">
                            <span>AI分镜解析</span>
                            <button class="edit-item text-gray-400 hover:text-primary transition-colors" data-id="ai-video-analysis">
                                <i class="fa fa-pencil"></i>
                            </button>
                        </div>
                        <div class="nav-item flex items-center justify-between px-3 py-2 rounded-md cursor-pointer hover:bg-gray-100" 
                             data-url="media-management.html" data-name="素材库">
                            <span>素材库</span>
                            <button class="edit-item text-gray-400 hover:text-primary transition-colors" data-id="media-library">
                                <i class="fa fa-pencil"></i>
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- 视频处理 -->
                <div class="nav-group mb-1">
                    <div class="nav-item flex items-center justify-between px-3 py-2.5 rounded-md cursor-pointer hover:bg-gray-100" data-group="video-processing">
                        <span>视频处理</span>
                        <button class="add-secondary text-gray-400 hover:text-primary transition-colors" data-parent="video-processing">
                            <i class="fa fa-plus-circle"></i>
                        </button>
                    </div>
                    <div class="subnav pl-6 overflow-hidden max-h-0 transition-height" id="video-processing">
                        <!-- 可通过添加按钮新增 -->
                    </div>
                </div>
                
                <!-- 投放数据 -->
                <div class="nav-group mb-1">
                    <div class="nav-item flex items-center justify-between px-3 py-2.5 rounded-md cursor-pointer hover:bg-gray-100" data-group="delivery-data">
                        <span>投放数据</span>
                        <button class="add-secondary text-gray-400 hover:text-primary transition-colors" data-parent="delivery-data">
                            <i class="fa fa-plus-circle"></i>
                        </button>
                    </div>
                    <div class="subnav pl-6 overflow-hidden max-h-0 transition-height" id="delivery-data">
                        <div class="nav-item flex items-center justify-between px-3 py-2 rounded-md cursor-pointer hover:bg-gray-100" 
                             data-url="https://niu.e.kuaishou.com" data-name="磁力金牛">
                            <span>磁力金牛</span>
                            <button class="edit-item text-gray-400 hover:text-primary transition-colors" data-id="cili-jinniu">
                                <i class="fa fa-pencil"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 历史记录部分 -->
            <div class="p-2 border-t border-gray-200 mt-2">
                <h2 class="text-xs font-semibold text-gray-500 uppercase tracking-wider px-3 py-2">历史记录</h2>
                <div id="history-list" class="space-y-1">
                    <!-- 历史记录将通过JavaScript动态添加 -->
                    <div class="text-gray-500 text-sm px-3 py-4 italic text-center">暂无访问记录</div>
                </div>
            </div>
        </div>
        
        <!-- 用户信息区域 -->
        <div class="p-3 border-t border-gray-200 bg-gray-50">
            <div class="flex items-center">
                <div class="w-8 h-8 bg-gray-300 rounded-full flex items-center justify-center text-gray-600 mr-3">
                    <i class="fa fa-user"></i>
                </div>
                <div>
                    <div class="text-sm font-medium">当前用户</div>
                    <div class="text-xs text-gray-500">admin@example.com</div>
                </div>
            </div>
        </div>
    </aside>
    
    <!-- 右侧内容区域 -->
    <main class="flex-1 flex flex-col h-full overflow-hidden">
        <!-- 顶部信息栏 -->
        <header class="bg-white border-b border-gray-200 p-4 shadow-sm">
            <div class="flex flex-col md:flex-row md:items-center justify-between">
                <div>
                    <h2 id="page-title" class="text-lg font-semibold">欢迎使用马上豹AI工具中心</h2>
                    <p id="page-url" class="text-sm text-gray-500 mt-1"></p>
                </div>
                <div class="mt-3 md:mt-0 flex items-center space-x-2">
                    <button id="refresh-page" class="px-3 py-1.5 bg-gray-100 hover:bg-gray-200 rounded text-sm transition-colors flex items-center">
                        <i class="fa fa-refresh mr-1"></i> 刷新
                    </button>
                    <button id="open-external" class="px-3 py-1.5 bg-primary hover:bg-primary/90 text-white rounded text-sm transition-colors flex items-center">
                        <i class="fa fa-external-link mr-1"></i> 新窗口打开
                    </button>
                </div>
            </div>
        </header>
        
        <!-- 内容展示区域 -->
        <div id="content-area" class="flex-1 overflow-hidden bg-gray-100">
            <div class="h-full flex items-center justify-center p-8 text-center">
                <div>
                    <div class="w-16 h-16 bg-primary/10 rounded-full flex items-center justify-center text-primary mx-auto mb-4">
                        <i class="fa fa-wrench text-2xl"></i>
                    </div>
                    <h3 class="text-xl font-medium mb-2">选择一个工具开始使用</h3>
                    <p class="text-gray-500 max-w-md mx-auto">从左侧导航栏选择您需要使用的工具，相关内容将显示在本区域</p>
                </div>
            </div>
            <!-- 这里将通过iframe加载具体内容 -->
        </div>
    </main>
    
    <!-- 编辑/新增导航项的模态框 -->
    <div id="edit-modal" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden opacity-0 transition-opacity duration-300">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-md transform transition-transform duration-300 scale-95">
            <div class="p-5 border-b border-gray-200 flex justify-between items-center">
                <h3 id="modal-title" class="text-lg font-semibold">编辑工具</h3>
                <button id="close-modal" class="text-gray-400 hover:text-gray-600">
                    <i class="fa fa-times"></i>
                </button>
            </div>
            <div class="p-5">
                <form id="edit-form">
                    <input type="hidden" id="item-id">
                    <input type="hidden" id="parent-group">
                    
                    <div class="mb-4">
                        <label for="item-name" class="block text-sm font-medium text-gray-700 mb-1">工具名称</label>
                        <input type="text" id="item-name" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary" required>
                    </div>
                    
                    <div class="mb-4">
                        <label for="item-url" class="block text-sm font-medium text-gray-700 mb-1">访问网址</label>
                        <input type="url" id="item-url" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary" required>
                        <p class="text-xs text-gray-500 mt-1">提示：使用http://或https://开头的网址可正常加载，本地文件需通过服务器访问</p>
                    </div>
                    
                    <div class="mb-4">
                        <label for="item-username" class="block text-sm font-medium text-gray-700 mb-1">登录用户名</label>
                        <input type="text" id="item-username" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary">
                    </div>
                    
                    <div class="mb-4">
                        <label for="item-password" class="block text-sm font-medium text-gray-700 mb-1">登录密码</label>
                        <div class="relative">
                            <input type="password" id="item-password" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary">
                            <button type="button" id="toggle-password" class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600">
                                <i class="fa fa-eye-slash"></i>
                            </button>
                        </div>
                    </div>
                </form>
            </div>
            <div class="p-4 border-t border-gray-200 flex justify-end space-x-3">
                <button id="delete-item" class="px-4 py-2 border border-red-200 text-red-600 rounded-md hover:bg-red-50 transition-colors hidden">
                    删除
                </button>
                <button id="cancel-edit" class="px-4 py-2 border border-gray-300 rounded-md hover:bg-gray-50 transition-colors">
                    取消
                </button>
                <button id="save-item" class="px-4 py-2 bg-primary text-white rounded-md hover:bg-primary/90 transition-colors">
                    保存
                </button>
            </div>
        </div>
    </div>
    
    <!-- 本地文件提示模态框 -->
    <div id="local-file-modal" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden opacity-0 transition-opacity duration-300">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-md transform transition-transform duration-300 scale-95">
            <div class="p-5 border-b border-gray-200 flex justify-between items-center">
                <h3 class="text-lg font-semibold">本地文件访问提示</h3>
                <button id="close-local-modal" class="text-gray-400 hover:text-gray-600">
                    <i class="fa fa-times"></i>
                </button>
            </div>
            <div class="p-5">
                <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4 mb-4">
                    <div class="flex">
                        <div class="flex-shrink-0">
                            <i class="fa fa-info-circle text-yellow-500"></i>
                        </div>
                        <div class="ml-3">
                            <p class="text-sm text-yellow-700">
                                由于浏览器安全限制，无法直接加载本地HTML文件。
                            </p>
                        </div>
                    </div>
                </div>
                
                <h4 class="font-medium mb-2">解决方案：</h4>
                <ul class="list-disc pl-5 text-sm text-gray-700 space-y-2">
                    <li>1. 将文件部署到Web服务器（如Nginx、Apache）</li>
                    <li>2. 使用简单的本地服务器，如Python的内置服务器：
                        <div class="bg-gray-100 p-2 rounded mt-1 text-xs">
                            python -m http.server 8000
                        </div>
                    </li>
                    <li>3. 直接在新窗口打开该文件</li>
                </ul>
            </div>
            <div class="p-4 border-t border-gray-200 flex justify-end space-x-3">
                <button id="open-local-in-new" class="px-4 py-2 bg-primary text-white rounded-md hover:bg-primary/90 transition-colors">
                    <i class="fa fa-external-link mr-1"></i> 新窗口打开
                </button>
            </div>
        </div>
    </div>
    
    <!-- 通知提示组件 -->
    <div id="notification" class="fixed top-4 right-4 bg-gray-800 text-white px-4 py-3 rounded-md shadow-lg transform translate-x-full transition-transform duration-300 flex items-center z-50">
        <i id="notification-icon" class="fa fa-check-circle mr-2 text-green-400"></i>
        <span id="notification-message">操作成功</span>
    </div>
    
    <script>
        // 全局状态管理
        const state = {
            activeGroup: null,
            activeItem: null,
            navData: {},
            history: [],
            currentLocalFile: null // 用于存储当前要访问的本地文件路径
        };
        
        // DOM元素引用
        const elements = {
            sidebar: document.getElementById('sidebar'),
            contentArea: document.getElementById('content-area'),
            pageTitle: document.getElementById('page-title'),
            pageUrl: document.getElementById('page-url'),
            refreshPage: document.getElementById('refresh-page'),
            openExternal: document.getElementById('open-external'),
            editModal: document.getElementById('edit-modal'),
            localFileModal: document.getElementById('local-file-modal'),
            modalTitle: document.getElementById('modal-title'),
            closeModal: document.getElementById('close-modal'),
            closeLocalModal: document.getElementById('close-local-modal'),
            openLocalInNew: document.getElementById('open-local-in-new'),
            cancelEdit: document.getElementById('cancel-edit'),
            saveItem: document.getElementById('save-item'),
            deleteItem: document.getElementById('delete-item'),
            editForm: document.getElementById('edit-form'),
            itemId: document.getElementById('item-id'),
            parentGroup: document.getElementById('parent-group'),
            itemName: document.getElementById('item-name'),
            itemUrl: document.getElementById('item-url'),
            itemUsername: document.getElementById('item-username'),
            itemPassword: document.getElementById('item-password'),
            togglePassword: document.getElementById('toggle-password'),
            notification: document.getElementById('notification'),
            notificationIcon: document.getElementById('notification-icon'),
            notificationMessage: document.getElementById('notification-message'),
            historyList: document.getElementById('history-list')
        };
        
        // 初始化应用
        function initApp() {
            // 加载导航数据
            loadNavData();
            // 加载历史记录
            loadHistory();
            // 绑定事件处理程序
            bindEvents();
        }
        
        // 加载导航数据
        function loadNavData() {
            // 这里可以从localStorage加载数据，初始时使用默认结构
            const savedData = localStorage.getItem('navData');
            if (savedData) {
                state.navData = JSON.parse(savedData);
            } else {
                // 初始化默认导航数据，添加工作台
                state.navData = {
                    'workbench': {
                        name: '工作台',
                        items: {
                            'workbench-home': { name: '工作台首页', url: 'work.html', username: '', password: '' }
                        }
                    },
                    'product-selection': {
                        name: '选品工具',
                        items: {
                            'dy-mall': { name: '抖音商城', url: 'https://shop.douyin.com/', username: '', password: '' },
                            'seller-sprite': { name: '卖家精灵', url: 'https://www.sellersprite.com/', username: '', password: '' },
                            'hot-news': { name: '热门资讯', url: 'news.html', username: '', password: '' }
                        }
                    },
                    'product-finding': {
                        name: '找品工具',
                        items: {
                            '1688': { name: '1688', url: 'https://www.1688.com/', username: '', password: '' }
                        }
                    },
                    'product-testing': {
                        name: '测品工具',
                        items: {
                            'kaogujia': { name: '考古加', url: 'https://ad.kaogujia.com/', username: '', password: '' }
                        }
                    },
                    'material-processing': {
                        name: '素材处理',
                        items: {
                            'preprocess': { name: '预处理下载', url: 'preprocess.html', username: '', password: '' },
                            'ai-video-analysis': { name: 'AI分镜解析', url: 'video-analysis.html', username: '', password: '' },
                            'media-library': { name: '素材库', url: 'media-management.html', username: '', password: '' }
                        }
                    },
                    'video-processing': {
                        name: '视频处理',
                        items: {}
                    },
                    'delivery-data': {
                        name: '投放数据',
                        items: {
                            'cili-jinniu': { name: '磁力金牛', url: 'https://niu.e.kuaishou.com', username: '', password: '' }
                        }
                    }
                };
                saveNavData();
            }
        }
        
        // 保存导航数据到localStorage
        function saveNavData() {
            localStorage.setItem('navData', JSON.stringify(state.navData));
        }
        
        // 其他JavaScript代码保持不变...
        // 加载历史记录
        function loadHistory() {
            // 模拟从cache文件夹加载，实际使用localStorage
            const savedHistory = localStorage.getItem('toolHistory');
            if (savedHistory) {
                state.history = JSON.parse(savedHistory);
                renderHistory();
            }
        }
        
        // 保存历史记录
        function saveHistory() {
            localStorage.setItem('toolHistory', JSON.stringify(state.history));
            renderHistory();
        }
        
        // 添加到历史记录
        function addToHistory(name, url) {
            // 检查是否已存在相同记录，如果存在则移到最前面
            const existingIndex = state.history.findIndex(item => item.url === url);
            if (existingIndex !== -1) {
                state.history.splice(existingIndex, 1);
            }
            
            // 添加新记录到开头
            state.history.unshift({
                id: Date.now().toString(),
                name,
                url,
                timestamp: new Date().toISOString()
            });
            
            // 限制历史记录数量
            if (state.history.length > 20) {
                state.history = state.history.slice(0, 20);
            }
            
            saveHistory();
        }
        
        // 渲染历史记录
        function renderHistory() {
            if (state.history.length === 0) {
                elements.historyList.innerHTML = '<div class="text-gray-500 text-sm px-3 py-4 italic text-center">暂无访问记录</div>';
                return;
            }
            
            elements.historyList.innerHTML = '';
            state.history.forEach(item => {
                const historyItem = document.createElement('div');
                historyItem.className = 'nav-item flex items-center justify-between px-3 py-2 rounded-md cursor-pointer hover:bg-gray-100 text-sm';
                historyItem.setAttribute('data-url', item.url);
                historyItem.setAttribute('data-name', item.name);
                
                // 格式化时间
                const date = new Date(item.timestamp);
                const formattedTime = `${date.getHours().toString().padStart(2, '0')}:${date.getMinutes().toString().padStart(2, '0')}`;
                
                historyItem.innerHTML = `
                    <div class="flex flex-col">
                        <span class="truncate">${item.name}</span>
                        <span class="text-xs text-gray-500 truncate mt-0.5">${formattedTime}</span>
                    </div>
                    <button class="delete-history text-gray-400 hover:text-red-500 transition-colors" data-id="${item.id}">
                        <i class="fa fa-trash-o"></i>
                    </button>
                `;
                
                elements.historyList.appendChild(historyItem);
                
                // 添加点击事件
                historyItem.addEventListener('click', (e) => {
                    if (!e.target.closest('.delete-history')) {
                        loadContent(item.url, item.name);
                    }
                });
                
                // 删除历史记录
                historyItem.querySelector('.delete-history').addEventListener('click', (e) => {
                    e.stopPropagation();
                    state.history = state.history.filter(h => h.id !== item.id);
                    saveHistory();
                });
            });
        }
        
        // 绑定事件处理程序
        function bindEvents() {
            // 一级导航点击事件 - 展开/折叠
            document.querySelectorAll('.nav-group > .nav-item').forEach(item => {
                item.addEventListener('click', () => {
                    const groupId = item.getAttribute('data-group');
                    toggleGroup(groupId);
                });
            });
            
            // 二级导航点击事件 - 加载内容
            document.querySelectorAll('.subnav .nav-item').forEach(item => {
                item.addEventListener('click', (e) => {
                    // 检查是否点击了编辑按钮，如果是则不加载内容
                    if (!e.target.closest('.edit-item')) {
                        const url = item.getAttribute('data-url');
                        const name = item.getAttribute('data-name');
                        loadContent(url, name);
                        
                        // 更新选中状态
                        updateActiveItem(item);
                    }
                });
            });
            
            // 编辑按钮点击事件
            document.querySelectorAll('.edit-item').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.stopPropagation(); // 阻止事件冒泡
                    const itemId = btn.getAttribute('data-id');
                    const itemEl = btn.closest('.nav-item');
                    const parentGroup = itemEl.closest('.subnav').id;
                    
                    openEditModal(itemId, parentGroup);
                });
            });
            
            // 添加二级导航按钮点击事件
            document.querySelectorAll('.add-secondary').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.stopPropagation(); // 阻止事件冒泡
                    const parentGroup = btn.getAttribute('data-parent');
                    
                    openAddModal(parentGroup);
                });
            });
            
            // 关闭模态框
            elements.closeModal.addEventListener('click', closeModal);
            elements.cancelEdit.addEventListener('click', closeModal);
            
            // 关闭本地文件提示模态框
            elements.closeLocalModal.addEventListener('click', closeLocalFileModal);
            
            // 在新窗口打开本地文件
            elements.openLocalInNew.addEventListener('click', () => {
                if (state.currentLocalFile) {
                    window.open(state.currentLocalFile, '_blank');
                    closeLocalFileModal();
                }
            });
            
            // 点击模态框外部关闭
            elements.editModal.addEventListener('click', (e) => {
                if (e.target === elements.editModal) {
                    closeModal();
                }
            });
            
            elements.localFileModal.addEventListener('click', (e) => {
                if (e.target === elements.localFileModal) {
                    closeLocalFileModal();
                }
            });
            
            // 保存导航项
            elements.saveItem.addEventListener('click', saveNavItem);
            
            // 删除导航项
            elements.deleteItem.addEventListener('click', deleteNavItem);
            
            // 切换密码可见性
            elements.togglePassword.addEventListener('click', togglePasswordVisibility);
            
            // 刷新页面
            elements.refreshPage.addEventListener('click', refreshCurrentPage);
            
            // 在新窗口打开
            elements.openExternal.addEventListener('click', openInNewWindow);
        }
        
        // 切换一级导航展开/折叠
        function toggleGroup(groupId) {
            // 如果点击的是当前展开的分组，则折叠
            if (state.activeGroup === groupId) {
                closeGroup(groupId);
                state.activeGroup = null;
                return;
            }
            
            // 关闭当前展开的分组
            if (state.activeGroup) {
                closeGroup(state.activeGroup);
            }
            
            // 展开新分组
            const groupEl = document.getElementById(groupId);
            groupEl.style.maxHeight = groupEl.scrollHeight + 'px';
            state.activeGroup = groupId;
        }
        
        // 关闭指定分组
        function closeGroup(groupId) {
            const groupEl = document.getElementById(groupId);
            groupEl.style.maxHeight = '0';
        }
        
        // 加载内容到右侧区域
        function loadContent(url, name) {
            // 更新标题和URL显示
            elements.pageTitle.textContent = name;
            elements.pageUrl.textContent = url;
            
            // 检查是否是本地文件（不是http/https开头的）
            if (!url.startsWith('http://') && !url.startsWith('https://')) {
                // 显示本地文件提示
                state.currentLocalFile = url;
                openLocalFileModal();
                
                // 仍然添加到历史记录
                addToHistory(name, url);
                
                return;
            }
            
            // 创建iframe加载内容
            elements.contentArea.innerHTML = `
                <iframe 
                    src="${url}" 
                    class="w-full h-full border-0"
                    title="${name}"
                    sandbox="allow-same-origin allow-scripts allow-popups allow-forms"
                ></iframe>
            `;
            
            // 添加到历史记录
            addToHistory(name, url);
            
            // 缓存图片资源（模拟实现）
            cacheResources(url);
        }
        
        // 模拟缓存资源
        function cacheResources(url) {
            // 实际项目中，这里可以实现资源缓存逻辑
            console.log(`缓存资源: ${url} 到 resource 文件夹`);
        }
        
        // 更新选中的导航项状态
        function updateActiveItem(itemEl) {
            // 移除所有选中状态
            document.querySelectorAll('.nav-item').forEach(el => {
                el.classList.remove('nav-active');
            });
            
            // 添加当前选中状态
            itemEl.classList.add('nav-active');
            state.activeItem = itemEl.getAttribute('data-id');
        }
        
        // 打开编辑模态框
        function openEditModal(itemId, parentGroup) {
            const itemData = state.navData[parentGroup].items[itemId];
            
            elements.modalTitle.textContent = '编辑工具';
            elements.itemId.value = itemId;
            elements.parentGroup.value = parentGroup;
            elements.itemName.value = itemData.name;
            elements.itemUrl.value = itemData.url;
            elements.itemUsername.value = itemData.username || '';
            elements.itemPassword.value = itemData.password || '';
            
            // 显示删除按钮
            elements.deleteItem.classList.remove('hidden');
            
            // 显示模态框
            openModal();
        }
        
        // 打开新增模态框
        function openAddModal(parentGroup) {
            elements.modalTitle.textContent = '新增工具';
            elements.itemId.value = '';
            elements.parentGroup.value = parentGroup;
            elements.itemName.value = '';
            elements.itemUrl.value = '';
            elements.itemUsername.value = '';
            elements.itemPassword.value = '';
            
            // 隐藏删除按钮
            elements.deleteItem.classList.add('hidden');
            
            // 显示模态框
            openModal();
        }
        
        // 打开模态框
        function openModal() {
            elements.editModal.classList.remove('hidden');
            // 触发动画
            setTimeout(() => {
                elements.editModal.classList.add('opacity-100');
                elements.editModal.querySelector('div').classList.remove('scale-95');
                elements.editModal.querySelector('div').classList.add('scale-100');
            }, 10);
            
            // 聚焦第一个输入框
            elements.itemName.focus();
        }
        
        // 关闭模态框
        function closeModal() {
            elements.editModal.classList.remove('opacity-100');
            elements.editModal.querySelector('div').classList.remove('scale-100');
            elements.editModal.querySelector('div').classList.add('scale-95');
            
            // 完全隐藏模态框
            setTimeout(() => {
                elements.editModal.classList.add('hidden');
            }, 300);
        }
        
        // 打开本地文件提示模态框
        function openLocalFileModal() {
            elements.localFileModal.classList.remove('hidden');
            // 触发动画
            setTimeout(() => {
                elements.localFileModal.classList.add('opacity-100');
                elements.localFileModal.querySelector('div').classList.remove('scale-95');
                elements.localFileModal.querySelector('div').classList.add('scale-100');
            }, 10);
        }
        
        // 关闭本地文件提示模态框
        function closeLocalFileModal() {
            elements.localFileModal.classList.remove('opacity-100');
            elements.localFileModal.querySelector('div').classList.remove('scale-100');
            elements.localFileModal.querySelector('div').classList.add('scale-95');
            
            // 完全隐藏模态框
            setTimeout(() => {
                elements.localFileModal.classList.add('hidden');
                state.currentLocalFile = null;
            }, 300);
        }
        
        // 保存导航项
        function saveNavItem() {
            const itemId = elements.itemId.value;
            const parentGroup = elements.parentGroup.value;
            const name = elements.itemName.value.trim();
            const url = elements.itemUrl.value.trim();
            const username = elements.itemUsername.value.trim();
            const password = elements.itemPassword.value;
            
            // 验证输入
            if (!name || !url) {
                showNotification('请填写工具名称和网址', 'error');
                return;
            }
            
            // 新增项目
            if (!itemId) {
                const newId = 'item_' + Date.now();
                if (!state.navData[parentGroup].items) {
                    state.navData[parentGroup].items = {};
                }
                
                state.navData[parentGroup].items[newId] = {
                    name,
                    url,
                    username,
                    password
                };
                
                // 添加到DOM
                const subnavEl = document.getElementById(parentGroup);
                const newItem = document.createElement('div');
                newItem.className = 'nav-item flex items-center justify-between px-3 py-2 rounded-md cursor-pointer hover:bg-gray-100';
                newItem.setAttribute('data-url', url);
                newItem.setAttribute('data-name', name);
                newItem.setAttribute('data-id', newId);
                
                newItem.innerHTML = `
                    <span>${name}</span>
                    <button class="edit-item text-gray-400 hover:text-primary transition-colors" data-id="${newId}">
                        <i class="fa fa-pencil"></i>
                    </button>
                `;
                
                subnavEl.appendChild(newItem);
                
                // 添加点击事件
                newItem.addEventListener('click', (e) => {
                    if (!e.target.closest('.edit-item')) {
                        loadContent(url, name);
                        updateActiveItem(newItem);
                    }
                });
                
                // 添加编辑事件
                newItem.querySelector('.edit-item').addEventListener('click', (e) => {
                    e.stopPropagation();
                    openEditModal(newId, parentGroup);
                });
                
                // 确保分组是展开的
                if (state.activeGroup !== parentGroup) {
                    toggleGroup(parentGroup);
                } else {
                    // 调整高度以适应新内容
                    subnavEl.style.maxHeight = subnavEl.scrollHeight + 'px';
                }
                
                showNotification('工具添加成功');
            } 
            // 编辑现有项目
            else {
                state.navData[parentGroup].items[itemId] = {
                    name,
                    url,
                    username,
                    password
                };
                
                // 更新DOM
                const itemEl = document.querySelector(`.nav-item[data-id="${itemId}"]`);
                if (itemEl) {
                    itemEl.setAttribute('data-url', url);
                    itemEl.setAttribute('data-name', name);
                    itemEl.querySelector('span').textContent = name;
                }
                
                showNotification('工具更新成功');
            }
            
            // 保存数据
            saveNavData();
            
            // 关闭模态框
            closeModal();
        }
        
        // 删除导航项
        function deleteNavItem() {
            if (confirm('确定要删除这个工具吗？')) {
                const itemId = elements.itemId.value;
                const parentGroup = elements.parentGroup.value;
                
                // 从数据中删除
                if (state.navData[parentGroup].items[itemId]) {
                    delete state.navData[parentGroup].items[itemId];
                    
                    // 从DOM中删除
                    const itemEl = document.querySelector(`.nav-item[data-id="${itemId}"]`);
                    if (itemEl) {
                        const subnavEl = document.getElementById(parentGroup);
                        subnavEl.removeChild(itemEl);
                        
                        // 调整高度
                        subnavEl.style.maxHeight = subnavEl.scrollHeight + 'px';
                    }
                    
                    // 保存数据
                    saveNavData();
                    
                    showNotification('工具已删除');
                    closeModal();
                }
            }
        }
        
        // 切换密码可见性
        function togglePasswordVisibility() {
            const type = elements.itemPassword.getAttribute('type') === 'password' ? 'text' : 'password';
            elements.itemPassword.setAttribute('type', type);
            
            // 切换图标
            const icon = elements.togglePassword.querySelector('i');
            if (type === 'password') {
                icon.classList.remove('fa-eye');
                icon.classList.add('fa-eye-slash');
            } else {
                icon.classList.remove('fa-eye-slash');
                icon.classList.add('fa-eye');
            }
        }
        
        // 刷新当前页面
        function refreshCurrentPage() {
            const iframe = elements.contentArea.querySelector('iframe');
            if (iframe) {
                iframe.src = iframe.src;
                showNotification('页面已刷新');
            }
        }
        
        // 在新窗口打开
        function openInNewWindow() {
            const url = elements.pageUrl.textContent;
            if (url) {
                window.open(url, '_blank');
            }
        }
        
        // 显示通知
        function showNotification(message, type = 'success') {
            elements.notificationMessage.textContent = message;
            
            // 设置图标
            if (type === 'success') {
                elements.notificationIcon.className = 'fa fa-check-circle mr-2 text-green-400';
            } else if (type === 'error') {
                elements.notificationIcon.className = 'fa fa-exclamation-circle mr-2 text-red-400';
            } else if (type === 'warning') {
                elements.notificationIcon.className = 'fa fa-exclamation-triangle mr-2 text-yellow-400';
            }
            
            // 显示通知
            elements.notification.classList.remove('translate-x-full');
            
            // 3秒后隐藏
            setTimeout(() => {
                elements.notification.classList.add('translate-x-full');
            }, 3000);
        }
        
        // 初始化应用
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>
    