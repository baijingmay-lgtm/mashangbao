<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>素材搜索筛选平台</title>
  <!-- 引入Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- 引入Font Awesome -->
  <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
  
  <!-- 配置Tailwind自定义颜色和字体 -->
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#165DFF',
            secondary: '#FF7D00',
            neutral: {
              100: '#F5F7FA',
              200: '#E5E6EB',
              300: '#C9CDD4',
              400: '#86909C',
              500: '#4E5969',
              600: '#272E3B',
              700: '#1D2129',
            }
          },
          fontFamily: {
            inter: ['Inter', 'system-ui', 'sans-serif'],
          },
        },
      }
    }
  </script>

  <!-- 点击下载文件夹路径修改功能 -->
  <script>
  document.addEventListener('DOMContentLoaded', function() {
    // 创建自定义弹窗
    const dialogHTML = `
      <div id='folderDialog' class='fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden'>
        <div class='bg-white rounded-lg shadow-xl p-6 w-full max-w-md'>
          <h3 class='text-lg font-medium text-neutral-700 mb-4'>修改下载文件夹路径</h3>
          <div class='mb-4'>
            <label class='block text-sm text-neutral-500 mb-2'>当前路径:</label>
            <input type='text' id='folderPathInput' class='w-full px-3 py-2 border border-neutral-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary' value='C:/Users/baijing/Desktop/下载'>
          </div>
          <div class='flex justify-end gap-3'>
            <button id='cancelBtn' class='px-4 py-2 border border-neutral-300 rounded-lg text-neutral-600 hover:bg-neutral-50'>取消</button>
            <button id='confirmBtn' class='px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary/90'>确认</button>
          </div>
        </div>
      </div>
    `;
    document.body.insertAdjacentHTML('beforeend', dialogHTML);

    const downloadFolder = document.getElementById('downloadFolder');
    const folderDialog = document.getElementById('folderDialog');
    const folderPathInput = document.getElementById('folderPathInput');
    const confirmBtn = document.getElementById('confirmBtn');
    const cancelBtn = document.getElementById('cancelBtn');

    if (downloadFolder && folderDialog && folderPathInput && confirmBtn && cancelBtn) {
      // 显示弹窗
      downloadFolder.addEventListener('click', function() {
        folderDialog.classList.remove('hidden');
        folderPathInput.focus();
      });

      // 取消按钮
      cancelBtn.addEventListener('click', function() {
        folderDialog.classList.add('hidden');
      });

      // 确认按钮
      confirmBtn.addEventListener('click', function() {
        const newPath = folderPathInput.value.trim();
        if (newPath) {
          downloadFolder.textContent = newPath.split('/').pop(); // 只显示文件夹名称
          alert('文件夹路径已更新为: ' + newPath);
          folderDialog.classList.add('hidden');
        } else {
          alert('请输入有效的文件夹路径');
        }
      });

      // 点击弹窗外部关闭
      folderDialog.addEventListener('click', function(e) {
        if (e.target === folderDialog) {
          folderDialog.classList.add('hidden');
        }
      });
    }
  });


  </script>
  
  <!-- 自定义工具类 -->
  <style type="text/tailwindcss">
    @layer utilities {
      .content-auto {
        content-visibility: auto;
      }
      .filter-active {
        @apply bg-primary text-white;
      }
      .card-hover {
        @apply transition-all duration-300 hover:shadow-lg hover:-translate-y-1;
      }
      .btn-primary {
        @apply bg-primary hover:bg-primary/90 text-white px-4 py-2 rounded-lg transition-all duration-200;
      }
      .btn-secondary {
        @apply bg-white border border-neutral-200 hover:border-primary text-neutral-700 px-4 py-2 rounded-lg transition-all duration-200;
      }
      .filter-chip {
        @apply px-3 py-2 rounded-lg transition-colors cursor-pointer whitespace-nowrap;
      }
      .filter-label {
        @apply font-medium text-neutral-700 mr-3 whitespace-nowrap;
      }
      .tag-select-wrapper {
        @apply relative mr-4 mb-2 sm:mb-0;
      }
      .tag-select {
        @apply pr-8 py-2 rounded-lg border border-neutral-200 focus:border-primary focus:ring-2 focus:ring-primary/20 outline-none transition-all text-sm bg-white;
      }
      .modal-backdrop {
        @apply fixed inset-0 bg-black/50 z-50 flex items-center justify-center opacity-0 transition-opacity duration-300 pointer-events-none;
      }
      .modal-backdrop.active {
        @apply opacity-100 pointer-events-auto;
      }
      .modal-content {
        @apply bg-white rounded-xl shadow-lg w-full max-w-2xl max-h-[90vh] overflow-auto transform transition-all duration-300 scale-95 opacity-0;
      }
      .modal-backdrop.active .modal-content {
        @apply scale-100 opacity-100;
      }
    }
  </style>
</head>
<body class="font-inter bg-neutral-100 text-neutral-700 min-h-screen flex flex-col">
  <!-- 顶部导航栏 -->
  <header class="bg-white shadow shadow-sm sticky top-0 z-50">
    <div class="container mx-auto px-4 py-3">
      <div class="flex items-center space-x-2 mb-3">
        <i class="fa fa-film text-primary text-2xl"></i>
        <h1 class="text-xl font-bold text-neutral-700">素材资源库</h1>
      </div>
      <nav class="flex border-b border-neutral-200">
        <a href="#" class="px-4 py-2 text-primary font-medium border-b-2 border-primary">素材库</a>
        <a href="recently-use.html" class="px-4 py-2 text-neutral-500 hover:text-primary transition-colors">最近使用</a>
        <a href="recently-add.html" class="px-4 py-2 text-neutral-500 hover:text-primary transition-colors">最近添加</a>
      </nav>
    </div>
  </header>

  <!-- 主内容区 -->
  <main class="flex-grow container mx-auto px-4 py-6">
    <!-- 搜索区域 -->
    <section class="mb-6">
      <div class="relative">
        <input type="text" placeholder="输入关键词搜索素材..." class="w-full pl-12 pr-4 py-3 rounded-xl border border-neutral-200 focus:border-primary focus:ring-2 focus:ring-primary/20 outline-none transition-all">
        <i class="fa fa-search absolute left-4 top-1/2 -translate-y-1/2 text-neutral-400"></i>
        <button class="absolute right-2 top-1/2 -translate-y-1/2 btn-primary">
          搜索
        </button>
      </div>
    </section>

    <!-- 筛选区域 -->
    <section class="bg-white rounded-xl shadow-sm p-4 mb-6">
      <!-- 素材分类 -->
      <div class="mb-4">
        <div class="flex flex-wrap items-center">
          <span class="filter-label">素材分类:</span>
          <button class="filter-chip filter-active mr-2 mb-2 sm:mb-0">
            全部
          </button>
          <button class="filter-chip hover:bg-neutral-100 mr-2 mb-2 sm:mb-0">
            分镜视频
          </button>
          <button class="filter-chip hover:bg-neutral-100 mb-2 sm:mb-0">
            成片视频
          </button>
        </div>
      </div>
      
      <!-- 素材标签 -->
      <div class="space-y-4">
        <div class="flex flex-wrap items-center">
          <span class="filter-label">素材标签:</span>
          
          <!-- 筛选标签组 -->
          <div class="flex flex-wrap flex-1">
            <!-- 是否收藏筛选 -->
            <div class="tag-select-wrapper">
              <select class="tag-select" id="favoriteFilter">
                <option value="">是否收藏</option>
                <option value="favorite">仅显示收藏</option>
                <option value="notfavorite">仅显示未收藏</option>
              </select>
            </div>
            
            <!-- 商品分类 -->
            <div class="tag-select-wrapper">
              <select class="tag-select">
                <option value="">商品分类</option>
                <option value="electronics">电子产品</option>
                <option value="clothing">服装鞋帽</option>
                <option value="food">食品饮料</option>
                <option value="home">家居用品</option>
              </select>
            </div>
            
            <!-- 人物分类 -->
            <div class="tag-select-wrapper">
              <select class="tag-select">
                <option value="">人物分类</option>
                <option value="male">男性</option>
                <option value="female">女性</option>
                <option value="children">儿童</option>
                <option value="group">群体</option>
              </select>
            </div>
            
            <!-- 运镜方式 -->
            <div class="tag-select-wrapper">
              <select class="tag-select">
                <option value="">运镜方式</option>
                <option value="pan">平移</option>
                <option value="tilt">倾斜</option>
                <option value="zoom">缩放</option>
                <option value="tracking">跟踪</option>
              </select>
            </div>
            
            <!-- 背景音效 -->
            <div class="tag-select-wrapper">
              <select class="tag-select">
                <option value="">背景音效</option>
                <option value="music">背景音乐</option>
                <option value="natural">自然声音</option>
                <option value="voice">人声</option>
                <option value="none">无音效</option>
              </select>
            </div>
            
            <!-- 水印字幕 -->
            <div class="tag-select-wrapper">
              <select class="tag-select">
                <option value="">水印字幕</option>
                <option value="watermark">有水印</option>
                <option value="subtitle">有字幕</option>
                <option value="both">两者都有</option>
                <option value="none">无</option>
              </select>
            </div>
            
            <!-- 镜头类型 -->
            <div class="tag-select-wrapper">
              <select class="tag-select">
                <option value="">镜头类型</option>
                <option value="close-up">特写</option>
                <option value="medium">中景</option>
                <option value="long">远景</option>
                <option value="wide">广角</option>
              </select>
            </div>
            
            <!-- 素材来源 -->
            <div class="tag-select-wrapper">
              <select class="tag-select">
                <option value="">素材来源</option>
                <option value="official">官方拍摄</option>
                <option value="third-party">第三方授权</option>
                <option value="self-made">自制素材</option>
              </select>
            </div>
            
            <!-- 视频时长 -->
            <div class="tag-select-wrapper py-1 ">
              <select class="tag-select">
                <option value="">视频时长</option>
                <option value="short">短 (&lt; 1分钟)</option>
                <option value="medium">中 (1-3分钟)</option>
                <option value="long">长 (&gt; 3分钟)</option>
              </select>
            </div>
            
            <!-- 自定义标签按钮 -->
            <button id="customTagBtn" class="flex items-center gap-2 text-primary border border-dashed border-primary/50 hover:bg-primary/5 px-3 py-1 rounded-lg transition-colors text-sm mb-2 sm:mb-0">
              <i class="fa fa-plus"></i>
              <span>添加自定义标签</span>
            </button>
          </div>
        </div>
        
        <!-- 已选标签 - 移至素材标签下方，左对齐 -->
        <div class="flex flex-wrap items-center gap-4 pl-[72px] sm:pl-[84px]">
          <span class="inline-flex items-center px-2 py-1 bg-primary/10 text-primary text-xs rounded-full">
            商品分类: 电子产品
            <button class="ml-1 text-primary/70 hover:text-primary"><i class="fa fa-times-circle"></i></button>
          </span>
          <span class="inline-flex items-center px-2 py-1 bg-primary/10 text-primary text-xs rounded-full">
            运镜方式: 平移
            <button class="ml-1 text-primary/70 hover:text-primary"><i class="fa fa-times-circle"></i></button>
          </span>
          <!-- 新增标签 -->
          <span class="inline-flex items-center px-2 py-1 bg-primary/10 text-primary text-xs rounded-full">
            镜头类型: 特写
            <button class="ml-1 text-primary/70 hover:text-primary"><i class="fa fa-times-circle"></i></button>
          </span>
        </div>
        
        <!-- 筛选操作按钮 -->
        <div class="mt-4 flex gap-3">
          <button class="btn-secondary">
            重置筛选
          </button>
          <button class="btn-primary">
            应用筛选
          </button>
        </div>
      </div>
    </section>

    <!-- 结果展示区域 -->
    <section>
      <!-- 结果统计和排序 -->
      <div class="bg-white rounded-xl shadow-sm p-4 mb-6 flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4">
        <div>
          <span class="font-medium">自动加载本地 <span class="text-primary underline cursor-pointer" id="downloadFolder">下载</span> 文件夹内 <span class="text-primary">1,245</span> 个结果</span>
        </div>
        <div class="flex items-center gap-3 w-full sm:w-auto">
          <label class="text-sm text-neutral-500">排序方式:</label>
          <select class="px-3 py-2 rounded-lg border border-neutral-200 focus:border-primary focus:ring-2 focus:ring-primary/20 outline-none transition-all text-sm">
            <option value="relevance">相关度优先</option>
            <option value="usage">使用频次高到低</option>
            <option value="time">入库时间新到旧</option>
            <option value="duration">时长从短到长</option>
          </select>
        </div>
      </div>
      
      <!-- 素材列表 - 每页12个 -->
      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-5">
        <!-- 素材项 1 -->
        <div class="bg-white rounded-xl shadow-sm overflow-hidden card-hover material-card">
          <div class="relative">
            <img src="" data-src="https://picsum.photos/400/225?random=1" alt="智能手机4K产品展示视频缩略图" class="w-full aspect-video object-cover cache-image" onerror="this.src='./icons/default-thumbnail.png'">
            <span class="absolute bottom-2 right-2 bg-black/70 text-white text-xs px-2 py-1 rounded">00:45</span>
            <button class="favorite-btn absolute top-2 right-2 w-8 h-8 bg-black/30 hover:bg-black/50 rounded-full flex items-center justify-center text-white transition-colors" data-id="1">
              <i class="fa fa-heart-o"></i>
            </button>
          </div>
          <div class="p-4">
            <h3 class="font-medium text-neutral-700 mb-2 line-clamp-1">智能手机4K产品展示视频</h3>
            <div class="text-xs text-neutral-500 space-y-1">
              <div class="flex justify-between">
                <span>入库时间</span>
                <span>2023-05-12</span>
              </div>
              <div class="flex justify-between">
                <span>使用频次</span>
                <span>128次</span>
              </div>
              <div class="flex justify-between">
                <span>素材来源</span>
                <span>官方拍摄</span>
              </div>
            </div>
            <div class="mt-3 flex flex-wrap gap-1">
              <span class="bg-neutral-100 text-neutral-600 text-xs px-2 py-0.5 rounded">电子产品</span>
              <span class="bg-neutral-100 text-neutral-600 text-xs px-2 py-0.5 rounded">特写</span>
              <span class="bg-neutral-100 text-neutral-600 text-xs px-2 py-0.5 rounded">平移</span>
            </div>
          </div>
        </div>
        
        <!-- 素材项 2 -->
        <div class="bg-white rounded-xl shadow-sm overflow-hidden card-hover material-card">
          <div class="relative">
            <img src="" data-src="https://picsum.photos/400/225?random=2" alt="服装模特展示视频缩略图" class="w-full aspect-video object-cover cache-image" onerror="this.src='./icons/default-thumbnail.png'">
            <span class="absolute bottom-2 right-2 bg-black/70 text-white text-xs px-2 py-1 rounded">01:22</span>
            <button class="favorite-btn absolute top-2 right-2 w-8 h-8 bg-black/30 hover:bg-black/50 rounded-full flex items-center justify-center text-white transition-colors" data-id="2">
              <i class="fa fa-heart"></i>
            </button>
          </div>
          <div class="p-4">
            <h3 class="font-medium text-neutral-700 mb-2 line-clamp-1">夏季服装模特走秀视频</h3>
            <div class="text-xs text-neutral-500 space-y-1">
              <div class="flex justify-between">
                <span>入库时间</span>
                <span>2023-06-23</span>
              </div>
              <div class="flex justify-between">
                <span>使用频次</span>
                <span>95次</span>
              </div>
              <div class="flex justify-between">
                <span>素材来源</span>
                <span>第三方授权</span>
              </div>
            </div>
            <div class="mt-3 flex flex-wrap gap-1">
              <span class="bg-neutral-100 text-neutral-600 text-xs px-2 py-0.5 rounded">服装鞋帽</span>
              <span class="bg-neutral-100 text-neutral-600 text-xs px-2 py-0.5 rounded">女性</span>
              <span class="bg-neutral-100 text-neutral-600 text-xs px-2 py-0.5 rounded">跟踪</span>
            </div>
          </div>
        </div>
        
        <!-- 素材项 3 -->
        <div class="bg-white rounded-xl shadow-sm overflow-hidden card-hover material-card">
          <div class="relative">
            <img src="" data-src="https://picsum.photos/400/225?random=3" alt="食品制作过程视频缩略图" class="w-full aspect-video object-cover cache-image" onerror="this.src='./icons/default-thumbnail.png'">
            <span class="absolute bottom-2 right-2 bg-black/70 text-white text-xs px-2 py-1 rounded">02:15</span>
            <button class="favorite-btn absolute top-2 right-2 w-8 h-8 bg-black/30 hover:bg-black/50 rounded-full flex items-center justify-center text-white transition-colors" data-id="3">
              <i class="fa fa-heart-o"></i>
            </button>
          </div>
          <div class="p-4">
            <h3 class="font-medium text-neutral-700 mb-2 line-clamp-1">烘焙蛋糕制作全过程</h3>
            <div class="text-xs text-neutral-500 space-y-1">
              <div class="flex justify-between">
                <span>入库时间</span>
                <span>2023-04-05</span>
              </div>
              <div class="flex justify-between">
                <span>使用频次</span>
                <span>210次</span>
              </div>
              <div class="flex justify-between">
                <span>素材来源</span>
                <span>自制素材</span>
              </div>
            </div>
            <div class="mt-3 flex flex-wrap gap-1">
              <span class="bg-neutral-100 text-neutral-600 text-xs px-2 py-0.5 rounded">食品饮料</span>
              <span class="bg-neutral-100 text-neutral-600 text-xs px-2 py-0.5 rounded">中景</span>
              <span class="bg-neutral-100 text-neutral-600 text-xs px-2 py-0.5 rounded">背景音乐</span>
            </div>
          </div>
        </div>
        
        <!-- 素材项 4 -->
        <div class="bg-white rounded-xl shadow-sm overflow-hidden card-hover material-card">
          <div class="relative">
            <img src="" data-src="https://picsum.photos/400/225?random=4" alt="家居用品展示视频缩略图" class="w-full aspect-video object-cover cache-image" onerror="this.src='./icons/default-thumbnail.png'">
            <span class="absolute bottom-2 right-2 bg-black/70 text-white text-xs px-2 py-1 rounded">00:58</span>
            <button class="favorite-btn absolute top-2 right-2 w-8 h-8 bg-black/30 hover:bg-black/50 rounded-full flex items-center justify-center text-white transition-colors" data-id="4">
              <i class="fa fa-heart-o"></i>
            </button>
          </div>
          <div class="p-4">
            <h3 class="font-medium text-neutral-700 mb-2 line-clamp-1">现代家居客厅布置展示</h3>
            <div class="text-xs text-neutral-500 space-y-1">
              <div class="flex justify-between">
                <span>入库时间</span>
                <span>2023-07-18</span>
              </div>
              <div class="flex justify-between">
                <span>使用频次</span>
                <span>76次</span>
              </div>
              <div class="flex justify-between">
                <span>素材来源</span>
                <span>官方拍摄</span>
              </div>
            </div>
            <div class="mt-3 flex flex-wrap gap-1">
              <span class="bg-neutral-100 text-neutral-600 text-xs px-2 py-0.5 rounded">家居用品</span>
              <span class="bg-neutral-100 text-neutral-600 text-xs px-2 py-0.5 rounded">广角</span>
              <span class="bg-neutral-100 text-neutral-600 text-xs px-2 py-0.5 rounded">缩放</span>
            </div>
          </div>
        </div>
        
        <!-- 更多素材项省略... -->
      </div>
      
      <!-- 分页 - 左对齐 -->
      <div class="mt-10 flex justify-start">
        <nav class="inline-flex rounded-lg shadow-sm overflow-hidden">
          <a href="#" class="px-4 py-2 bg-white border border-neutral-200 text-neutral-500 hover:bg-neutral-50 transition-colors">
            <i class="fa fa-angle-left"></i>
          </a>
          <a href="#" class="px-4 py-2 bg-primary text-white border border-primary">
            1
          </a>
          <a href="#" class="px-4 py-2 bg-white border border-neutral-200 text-neutral-700 hover:bg-neutral-50 transition-colors">
            2
          </a>
          <a href="#" class="px-4 py-2 bg-white border border-neutral-200 text-neutral-700 hover:bg-neutral-50 transition-colors">
            3
          </a>
          <a href="#" class="px-4 py-2 bg-white border border-neutral-200 text-neutral-700 hover:bg-neutral-50 transition-colors">
            4
          </a>
          <a href="#" class="px-4 py-2 bg-white border border-neutral-200 text-neutral-700 hover:bg-neutral-50 transition-colors">
            5
          </a>
          <a href="#" class="px-4 py-2 bg-white border border-neutral-200 text-neutral-500 hover:bg-neutral-50 transition-colors">
            <i class="fa fa-angle-right"></i>
          </a>
        </nav>
      </div>
      
      <!-- 添加素材提示和按钮 -->
      <div class="mt-6 flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4">
        <p class="text-neutral-600">没有找到理想的素材？点击添加</p>
        <div class="flex gap-3 w-full sm:w-auto">
          <button id="localAddBtn" class="flex-1 sm:flex-none btn-secondary flex items-center justify-center gap-2">
            <i class="fa fa-upload"></i>
            <span>从文件夹添加</span>
          </button>
          <button id="netAddBtn" class="flex-1 sm:flex-none btn-primary flex items-center justify-center gap-2">
            <i class="fa fa-cloud-download"></i>
            <span>从网络添加</span>
          </button>
        </div>
      </div>
    </section>
  </main>

  <!-- 页脚 -->
  <footer class="bg-white border-t border-neutral-200 py-6 mt-10">
    <div class="container mx-auto px-4 text-center text-neutral-500 text-sm">
      <p>© 2023 素材资源库 版权所有</p>
      <div class="flex justify-center space-x-4 mt-2">
        <a href="#" class="hover:text-primary transition-colors">使用条款</a>
        <a href="#" class="hover:text-primary transition-colors">隐私政策</a>
        <a href="#" class="hover:text-primary transition-colors">帮助中心</a>
      </div>
    </div>
  </footer>

  <!-- 弹窗容器 -->
  <div id="modalContainer" class="modal-backdrop">
    <div class="modal-content p-6">
      <div class="flex justify-between items-center mb-4">
        <h3 id="modalTitle" class="text-lg font-semibold text-neutral-700">弹窗标题</h3>
        <button id="closeModalBtn" class="text-neutral-400 hover:text-neutral-700 transition-colors">
          <i class="fa fa-times"></i>
        </button>
      </div>
      <div id="modalContent" class="min-h-[200px]">
        <!-- 弹窗内容将通过iframe加载 -->
      </div>
    </div>
  </div>

  <!-- 自定义标签弹窗 -->
  <div id="customTagModal" class="modal-backdrop">
    <div class="modal-content p-6">
      <div class="flex justify-between items-center mb-4">
        <h3 class="text-lg font-semibold text-neutral-700">添加自定义标签</h3>
        <button class="close-modal-btn text-neutral-400 hover:text-neutral-700 transition-colors">
          <i class="fa fa-times"></i>
        </button>
      </div>
      
      <div class="space-y-4">
        <div>
          <label class="block text-sm font-medium text-neutral-600 mb-1">标签名称</label>
          <input type="text" placeholder="例如：季节、场景..." class="w-full px-3 py-2 rounded-lg border border-neutral-200 focus:border-primary focus:ring-2 focus:ring-primary/20 outline-none transition-all">
        </div>
        
        <div>
          <div class="flex justify-between items-center mb-1">
            <label class="block text-sm font-medium text-neutral-600">标签值</label>
            <button id="addTagValueBtn" class="text-xs text-primary hover:text-primary/80 transition-colors">
              <i class="fa fa-plus-circle mr-1"></i>添加值
            </button>
          </div>
          
          <div id="tagValuesContainer" class="space-y-2">
            <div class="flex gap-2">
              <input type="text" placeholder="标签值1" class="flex-1 px-3 py-2 rounded-lg border border-neutral-200 focus:border-primary focus:ring-2 focus:ring-primary/20 outline-none transition-all">
              <button class="removeTagValueBtn text-neutral-400 hover:text-red-500 transition-colors self-center">
                <i class="fa fa-minus-circle"></i>
              </button>
            </div>
          </div>
        </div>
      </div>
      
      <div class="mt-6 flex gap-3">
        <button class="close-modal-btn flex-1 btn-secondary">
          取消
        </button>
        <button id="confirmTagBtn" class="flex-1 btn-primary">
          确认添加
        </button>
      </div>
    </div>
  </div>

  <!-- JavaScript -->
  <script>
    // 图片缓存管理器 - 支持所有图片和图标缓存
    const ImageCacheManager = {
      // 检查浏览器是否支持IndexedDB
      isSupported() {
        return 'indexedDB' in window;
      },
      
      // 打开数据库连接
      openDB() {
        return new Promise((resolve, reject) => {
          if (!this.isSupported()) {
            reject('浏览器不支持IndexedDB，无法缓存图片');
            return;
          }
          
          const request = indexedDB.open('MaterialImageCache', 1);
          
          request.onupgradeneeded = (event) => {
            const db = event.target.result;
            // 创建存储对象，用于保存图片
            if (!db.objectStoreNames.contains('images')) {
              db.createObjectStore('images', { keyPath: 'url' });
            }
          };
          
          request.onsuccess = (event) => {
            this.db = event.target.result;
            resolve(this.db);
          };
          
          request.onerror = (event) => {
            reject(`打开数据库失败: ${event.target.error}`);
          };
        });
      },
      
      // 缓存图片
      cacheImage(url) {
        return new Promise(async (resolve, reject) => {
          try {
            // 先检查是否已缓存
            const cached = await this.getCachedImage(url);
            if (cached) {
              resolve(true);
              return;
            }
            
            // 下载图片
            const response = await fetch(url);
            if (!response.ok) {
              throw new Error(`下载图片失败: ${response.statusText}`);
            }
            
            const blob = await response.blob();
            
            // 存入IndexedDB
            const transaction = this.db.transaction('images', 'readwrite');
            const store = transaction.objectStore('images');
            
            const request = store.add({
              url: url,
              blob: blob,
              timestamp: new Date().getTime()
            });
            
            request.onsuccess = () => {
              resolve(true);
            };
            
            request.onerror = () => {
              // 如果是重复添加则忽略错误
              if (request.error.name === 'ConstraintError') {
                resolve(true);
              } else {
                reject(request.error);
              }
            };
          } catch (error) {
            console.error('缓存图片失败:', error);
            resolve(false); // 缓存失败不影响页面显示
          }
        });
      },
      
      // 获取缓存的图片
      getCachedImage(url) {
        return new Promise((resolve, reject) => {
          if (!this.db) {
            resolve(null);
            return;
          }
          
          const transaction = this.db.transaction('images', 'readonly');
          const store = transaction.objectStore('images');
          const request = store.get(url);
          
          request.onsuccess = () => {
            resolve(request.result ? request.result.blob : null);
          };
          
          request.onerror = () => {
            reject(request.error);
          };
        });
      },
      
      // 从缓存加载图片到img元素
      async loadImageFromCache(imgElement) {
        const url = imgElement.dataset.src;
        if (!url) return false;
        
        try {
          const blob = await this.getCachedImage(url);
          if (blob) {
            // 从缓存加载
            imgElement.src = URL.createObjectURL(blob);
            return true;
          } else {
            // 从网络加载并缓存
            imgElement.src = url;
            this.cacheImage(url);
            return false;
          }
        } catch (error) {
          console.error('加载图片失败:', error);
          // 加载失败使用默认图片
          imgElement.src = './icons/default-thumbnail.png';
          return false;
        }
      },
      
      // 缓存页面中所有图标
      async cacheAllIcons() {
        if (!this.db) return;
        
        // 获取所有Font Awesome图标
        const iconElements = document.querySelectorAll('i[class*="fa-"]');
        const iconClasses = new Set();
        
        iconElements.forEach(icon => {
          Array.from(icon.classList).forEach(cls => {
            if (cls.startsWith('fa-') && cls !== 'fa') {
              iconClasses.add(cls);
            }
          });
        });
        
        console.log(`发现 ${iconClasses.size} 种不同的图标，开始缓存字体文件`);
        
        // 缓存Font Awesome字体文件
        const fontUrls = [
          'https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/fonts/fontawesome-webfont.woff2?v=4.7.0',
          'https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/fonts/fontawesome-webfont.woff?v=4.7.0',
          'https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/fonts/fontawesome-webfont.ttf?v=4.7.0'
        ];
        
        for (const url of fontUrls) {
          await this.cacheImage(url);
        }
      }
    };

    // 初始化图片缓存
    async function initImageCache() {
      try {
        await ImageCacheManager.openDB();
        console.log('图片缓存数据库初始化成功');
        
        // 缓存所有图标字体
        await ImageCacheManager.cacheAllIcons();
        
        // 加载所有需要缓存的图片
        const cacheImages = document.querySelectorAll('.cache-image');
        cacheImages.forEach(img => {
          ImageCacheManager.loadImageFromCache(img);
        });
      } catch (error) {
        console.error('图片缓存初始化失败:', error);
        // 初始化失败时直接从网络加载图片
        document.querySelectorAll('.cache-image').forEach(img => {
          img.src = img.dataset.src || './icons/default-thumbnail.png';
        });
      }
    }

    // 弹窗管理器
    const ModalManager = {
      modalContainer: document.getElementById('modalContainer'),
      modalTitle: document.getElementById('modalTitle'),
      modalContent: document.getElementById('modalContent'),
      closeBtn: document.getElementById('closeModalBtn'),
      iframe: null,
      
      // 初始化弹窗
      init() {
        // 创建iframe元素
        this.iframe = document.createElement('iframe');
        this.iframe.className = 'w-full h-full border-0';
        this.iframe.style.minHeight = '400px';
        
        // 绑定关闭事件
        this.closeBtn.addEventListener('click', () => this.close());
        
        // 点击背景关闭
        this.modalContainer.addEventListener('click', (e) => {
          if (e.target === this.modalContainer) {
            this.close();
          }
        });
        
        // 其他弹窗的关闭按钮
        document.querySelectorAll('.close-modal-btn').forEach(btn => {
          btn.addEventListener('click', () => {
            btn.closest('.modal-backdrop').classList.remove('active');
          });
        });
      },
      
      // 打开弹窗并加载指定页面
      open(title, url) {
        this.modalTitle.textContent = title;
        
        // 清空并添加iframe
        this.modalContent.innerHTML = '';
        this.iframe.src = url;
        this.modalContent.appendChild(this.iframe);
        
        // 显示弹窗
        this.modalContainer.classList.add('active');
      },
      
      // 关闭弹窗
      close() {
        this.modalContainer.classList.remove('active');
        // 停止iframe加载
        this.iframe.src = 'about:blank';
      }
    };

    // 收藏功能管理
    const FavoriteManager = {
      // 初始化收藏状态
      init() {
        // 从本地存储加载收藏状态
        const favorites = this.getFavorites();
        
        // 更新UI显示
        document.querySelectorAll('.favorite-btn').forEach(btn => {
          const id = btn.dataset.id;
          if (favorites.includes(id)) {
            btn.innerHTML = '<i class="fa fa-heart"></i>';
          } else {
            btn.innerHTML = '<i class="fa fa-heart-o"></i>';
          }
        });
        
        // 绑定收藏按钮事件
        this.bindEvents();
        
        // 绑定收藏筛选事件
        this.bindFilterEvent();
      },
      
      // 获取所有收藏的素材ID
      getFavorites() {
        const favorites = localStorage.getItem('materialFavorites');
        return favorites ? JSON.parse(favorites) : [];
      },
      
      // 切换素材收藏状态
      toggleFavorite(id) {
        let favorites = this.getFavorites();
        const index = favorites.indexOf(id);
        
        if (index > -1) {
          // 取消收藏
          favorites.splice(index, 1);
          return false;
        } else {
          // 添加收藏
          favorites.push(id);
          return true;
        }
      },
      
      // 保存收藏状态到本地存储
      saveFavorites(favorites) {
        localStorage.setItem('materialFavorites', JSON.stringify(favorites));
      },
      
      // 绑定收藏按钮事件
      bindEvents() {
        document.querySelectorAll('.favorite-btn').forEach(btn => {
          btn.addEventListener('click', (e) => {
            e.stopPropagation();
            const id = btn.dataset.id;
            const isFavorite = this.toggleFavorite(id);
            
            // 更新UI
            if (isFavorite) {
              btn.innerHTML = '<i class="fa fa-heart"></i>';
            } else {
              btn.innerHTML = '<i class="fa fa-heart-o"></i>';
            }
            
            // 保存到本地存储
            this.saveFavorites(this.getFavorites());
            
            // 应用当前筛选条件
            this.applyFilter();
          });
        });
      },
      
      // 绑定收藏筛选事件
      bindFilterEvent() {
        const filter = document.getElementById('favoriteFilter');
        filter.addEventListener('change', () => {
          this.applyFilter();
        });
      },
      
      // 应用收藏筛选
      applyFilter() {
        const filterValue = document.getElementById('favoriteFilter').value;
        const favorites = this.getFavorites();
        
        document.querySelectorAll('.material-card').forEach(card => {
          const id = card.querySelector('.favorite-btn').dataset.id;
          const isFavorite = favorites.includes(id);
          
          // 根据筛选条件显示或隐藏卡片
          if (filterValue === 'favorite') {
            card.style.display = isFavorite ? 'block' : 'none';
          } else if (filterValue === 'notfavorite') {
            card.style.display = !isFavorite ? 'block' : 'none';
          } else {
            card.style.display = 'block';
          }
        });
      }
    };

    // 自定义标签逻辑
    function initCustomTagLogic() {
      const customTagBtn = document.getElementById('customTagBtn');
      const customTagModal = document.getElementById('customTagModal');
      const addTagValueBtn = document.getElementById('addTagValueBtn');
      const tagValuesContainer = document.getElementById('tagValuesContainer');
      const confirmTagBtn = document.getElementById('confirmTagBtn');
      
      // 打开自定义标签弹窗
      customTagBtn.addEventListener('click', () => {
        customTagModal.classList.add('active');
      });
      
      // 添加标签值输入框
      addTagValueBtn.addEventListener('click', () => {
        const inputCount = tagValuesContainer.querySelectorAll('input').length + 1;
        const newInputGroup = document.createElement('div');
        newInputGroup.className = 'flex gap-2';
        newInputGroup.innerHTML = `
          <input type="text" placeholder="标签值${inputCount}" class="flex-1 px-3 py-2 rounded-lg border border-neutral-200 focus:border-primary focus:ring-2 focus:ring-primary/20 outline-none transition-all">
          <button class="removeTagValueBtn text-neutral-400 hover:text-red-500 transition-colors self-center">
            <i class="fa fa-minus-circle"></i>
          </button>
        `;
        tagValuesContainer.appendChild(newInputGroup);
        
        // 为新添加的删除按钮绑定事件
        newInputGroup.querySelector('.removeTagValueBtn').addEventListener('click', function() {
          tagValuesContainer.removeChild(newInputGroup);
          updateTagValuePlaceholders();
        });
      });
      
      // 删除标签值输入框
      document.addEventListener('click', (e) => {
        if (e.target.closest('.removeTagValueBtn')) {
          const btn = e.target.closest('.removeTagValueBtn');
          const inputGroup = btn.parentElement;
          if (tagValuesContainer.children.length > 1) {
            tagValuesContainer.removeChild(inputGroup);
            updateTagValuePlaceholders();
          } else {
            // 至少保留一个输入框
            inputGroup.querySelector('input').value = '';
          }
        }
      });
      
      // 确认添加自定义标签
      confirmTagBtn.addEventListener('click', () => {
        const tagName = customTagModal.querySelector('input[type="text"]').value.trim();
        const tagValues = Array.from(tagValuesContainer.querySelectorAll('input'))
          .map(input => input.value.trim())
          .filter(value => value);
        
        if (tagName && tagValues.length > 0) {
          // 添加标签到已选标签区域
          const selectedTagsContainer = document.querySelector('.flex.flex-wrap.items-center.gap-4.pl-\\[72px\\]');
          const newTag = document.createElement('span');
          newTag.className = 'inline-flex items-center px-2 py-1 bg-primary/10 text-primary text-xs rounded-full';
          newTag.innerHTML = `${tagName}: ${tagValues.join(', ')}
            <button class="ml-1 text-primary/70 hover:text-primary"><i class="fa fa-times-circle"></i></button>`;
          
          // 添加删除事件
          newTag.querySelector('button').addEventListener('click', () => {
            selectedTagsContainer.removeChild(newTag);
          });
          
          selectedTagsContainer.appendChild(newTag);
          
          // 关闭弹窗
          customTagModal.classList.remove('active');
          
          // 清空输入
          customTagModal.querySelector('input[type="text"]').value = '';
          tagValuesContainer.innerHTML = `
            <div class="flex gap-2">
              <input type="text" placeholder="标签值1" class="flex-1 px-3 py-2 rounded-lg border border-neutral-200 focus:border-primary focus:ring-2 focus:ring-primary/20 outline-none transition-all">
              <button class="removeTagValueBtn text-neutral-400 hover:text-red-500 transition-colors self-center">
                <i class="fa fa-minus-circle"></i>
              </button>
            </div>
          `;
        } else {
          alert('请输入标签名称和至少一个标签值');
        }
      });
      
      // 更新标签值输入框的占位符序号
      function updateTagValuePlaceholders() {
        const inputs = tagValuesContainer.querySelectorAll('input');
        inputs.forEach((input, index) => {
          input.placeholder = `标签值${index + 1}`;
        });
      }
    }

    // 初始化添加素材按钮事件
    function initAddMaterialButtons() {
      const localAddBtn = document.getElementById('localAddBtn');
      const netAddBtn = document.getElementById('netAddBtn');
      
      // 本地添加按钮
      localAddBtn.addEventListener('click', () => {
        ModalManager.open('从本地添加素材', 'local.html');
      });
      
      // 网络添加按钮
      netAddBtn.addEventListener('click', () => {
        ModalManager.open('从网络添加素材', 'net.html');
      });
    }

    // 页面加载完成后初始化
    document.addEventListener('DOMContentLoaded', () => {
      // 初始化弹窗管理器
      ModalManager.init();
      
      // 初始化图片缓存
      initImageCache();
      
      // 初始化收藏功能
      FavoriteManager.init();
      
      // 初始化自定义标签逻辑
      initCustomTagLogic();
      
      // 初始化添加素材按钮
      initAddMaterialButtons();
      
      // 初始化卡片动画
      const cards = document.querySelectorAll('.card-hover');
      cards.forEach((card, index) => {
        setTimeout(() => {
          card.style.opacity = '1';
          card.style.transform = 'translateY(0)';
        }, 100 * index);
      });
    });
  </script>
</body>
</html>
